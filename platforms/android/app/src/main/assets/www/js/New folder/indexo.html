<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'"/>

        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" type="text/css" href="css/index.css">
        <title>HelloPlaces</title>
    </head>
    <body>
        <div class="app">
            <br>
            <div id="deviceready" class="blink">
                <p>HelloPlaces</p>
                <p class="event listening" >Connecting...</p>
                
                <p class="event received" onclick="getScanResults()">SilentClasses</p>
                <p onclick="storagecheck()"> By Shreyas kapale </p>
            </div>
        </div>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
        	document.addEventListener("deviceready", onDeviceReady, false);
            var  wifi = "xyz";
function onDeviceReady() {
	
var storage = window.localStorage;


var regs = [
    { BSSID: 'bc:8a:e8:18:94:29', org_name: 'taj'},
    { BSSID: '64:db:43:d8:ef:45', org_name: 'ramkrishna' },
    { BSSID: 'bc:sa:e8:18:94:29', org_name: 'overvase'}
];

var regs = JSON.stringify(regs);
storage.setItem("reglocal", regs);


var Permission = window.plugins.Permission;
 
var permission = 'android.permission.ACCESS_FINE_LOCATION'
 
Permission.has(permission, function(results) {
    if (!results[permission]) {
        Permission.request(permission, function(results) {
            if (result[permission]) {
                // permission is granted
            }
        }, alert)
    }
}, alert)






}






function getScanResults() {




var wifi = WifiWizard.getScanResults(function(wifis) {


    enabled = false;
   WifiWizard2.setWifiEnabled(enabled);
    enabled = true;
    WifiWizard2.setWifiEnabled(enabled);


  


    var reg = window.localStorage.getItem("reglocal");
    var reg = JSON.parse(reg);
    
    var getwifis = wifis;

    i = 0;
    j = 0;

   for (i = 0; i < 5; i++) {
   
        for (j = 0; j < 3; j++){

            wifiB = getwifis[i].BSSID;
            wifirB = reg[j].BSSID;

            if(wifiB.localeCompare(wifirB)===0){
                    rule = j;
                    run_main(rule);
            }        



        }
} 

})
}

function storagecheck() {

    var xstr = window.localStorage.getItem("1");
    alert(xstr);
}

function run_main(rule)
{

    if(rule === 0)
    {
        
        audio_mode.change_audio_mode("vibrate", function(success){},function(err){});
    }
    else if(rule === 1)
    {
        window.location.href = "ramkrishna/ram.html";
        audio_mode.change_audio_mode("vibrate", function(success){},function(err){});

    }

   // audio_mode.change_audio_mode("vibrate", function(success){},function(err){});
   // window.location.href = "taj/taj.html";
    
}


window.setInterval(function(){
getScanResults();  
}, 5000);

        </script>

    </body>
</html>
