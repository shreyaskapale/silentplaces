<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'"/>

        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" type="text/css" href="css/index.css">
        <title>HelloPlaces</title>
    </head>
    <body>
        <div class="app">
            <div style="border-style: solid; padding: 2px;">
            <p >S I L E N T &nbsp&nbsp P L A C E S </p>
            </div>
            <div id="devicereadyx" class="blink" style="padding-top: 30%;">
                
                <p class="event listening" style="font-size: 20px" onclick="silent_action()" >S I L E N C E</p>
                
                <br>
              

            </div>
                  <div style="border-style: dashed;border-width:2px ;padding: 10px; padding-top: 5%;">
                <p> Go to your desired silent zone where you want your phone to be silent and click on "Silent this place"</p>
                </div>
                <br>
                <div style="border-style: dashed;border-width:2px ;padding: 10px; padding-top: 5%;">
                <center><p>BSSID SELECTED</p></center>
                <p id="selected_place"></p>
                </div>
              <p style="padding-top: 40%"><b>&#169; 2018 &nbsp X E R F I A  </b></p>
              <p>Made with &#10084; by Shreyas Kapale</p>

        </div>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
        	document.addEventListener("deviceready", onDeviceReady, false);
            var  wifi = "xyz";
function onDeviceReady() { 

alert("W E L C O M E");
}

/*var storage = window.localStorage;


var regs = [
    { BSSID: 'bc:8a:e8:18:94:29', org_name: 'taj'},
    { BSSID: '64:db:43:d8:ef:45', org_name: 'ramkrishna' },
    { BSSID: 'bc:sa:e8:18:94:29', org_name: 'overvase'}
];

var regs = JSON.stringify(regs);
storage.setItem("reglocal", regs);


var Permission = window.plugins.Permission;
 
var permission = 'android.permission.ACCESS_FINE_LOCATION'
 
Permission.has(permission, function(results) {
    if (!results[permission]) {
        Permission.request(permission, function(results) {
            if (result[permission]) {
                // permission is granted
            }
        }, alert)
    }
}, alert)






}

*/
function silent_action(){
	alert("running silent");
	set_wifi_spot();
}


 function check_wifi_permission(){ 
    // wifi access needs location permissions  
        var Permission = window.plugins.Permission;
        var permission = 'android.permission.ACCESS_FINE_LOCATION'
            Permission.has(permission, function(results) {
                if (!results[permission]) {
                    //If permission not given ask permission
                    Permission.request(permission, function(results) {
                        if (result[permission]) {
                        // permission is granted
                        }
                    }, alert)
                }
            }, alert)

        }


    function set_wifi_spot(){
        var wifi = WifiWizard.getScanResults(function(wifis) {
            enabled = false;
            WifiWizard2.setWifiEnabled(enabled);
            enabled = true;
            WifiWizard2.setWifiEnabled(enabled);
            var selected_bssid = wifis[0].BSSID;
            storage.setItem("sbssid", selected_bssid);
            selected_distance = 10*Math.pow(10, ((27.55 - (20 * log(getwifis[0].frequency)) + getwifis[0].level));
            storage.setItem("sdistance",selected_distance);

        }
    }

function log(x)
{
    return Math.log(x)
}









/*
function getScanResults() {




var wifi = WifiWizard.getScanResults(function(wifis) {


    enabled = false;
   WifiWizard2.setWifiEnabled(enabled);
    enabled = true;
    WifiWizard2.setWifiEnabled(enabled);


  


    var reg = window.localStorage.getItem("reglocal");
    var reg = JSON.parse(reg);
    
    var getwifis = wifis;

    i = 0;
    j = 0;

   for (i = 0; i < 5; i++) {
   
        for (j = 0; j < 3; j++){

            wifiB = getwifis[i].BSSID;
            wifirB = reg[j].BSSID;

            if(wifiB.localeCompare(wifirB)===0){
                    rule = j;
                    run_main(rule);
            }        



        }
} 

})
}

function storagecheck() {

    var xstr = window.localStorage.getItem("1");
    alert(xstr);
}

function run_main(rule)
{

    if(rule === 0)
    {
        
        audio_mode.change_audio_mode("vibrate", function(success){},function(err){});
    }
    else if(rule === 1)
    {
        window.location.href = "ramkrishna/ram.html";
        audio_mode.change_audio_mode("vibrate", function(success){},function(err){});

    }

   // audio_mode.change_audio_mode("vibrate", function(success){},function(err){});
   // window.location.href = "taj/taj.html";
    
}


window.setInterval(function(){
getScanResults();  
}, 5000);
*/
        </script>

    </body>
</html>
